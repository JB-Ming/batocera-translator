# 空白描述自動搜尋功能

## 功能說明

當遊戲的描述（`desc`）為空白時，程式會**自動使用遊戲名稱**去搜尋並填入描述。

## 工作原理

### 觸發條件

描述會被自動搜尋填入，當：
1. ✓ `desc` 為空字串 (`""`)
2. ✓ `desc_source` 為空或不存在
3. ✓ `original_desc` 為空或只有空白字元

### 搜尋策略

當檢測到空白描述時，程式會依序嘗試：

```
┌─────────────────────────────────────────┐
│ 1. 維基百科 (Wikipedia)                 │
│    - 使用遊戲名稱搜尋維基頁面           │
│    - 提取頁面摘要作為描述               │
│    - 來源: "wiki"                       │
└───────────────┬─────────────────────────┘
                ↓ 找不到
┌─────────────────────────────────────────┐
│ 2. Gemini AI (如果已設定)               │
│    - 使用 AI 生成遊戲描述               │
│    - 更智能的內容                       │
│    - 來源: "gemini"                     │
└───────────────┬─────────────────────────┘
                ↓ 找不到或未設定
┌─────────────────────────────────────────┐
│ 3. 保持空白                              │
│    - 真的找不到資料就不填入             │
└─────────────────────────────────────────┘
```

### 改進功能 🆕

**優先使用已翻譯的名稱搜尋**：
- 如果遊戲名稱已經翻譯（如 "加州熱燒室"），會用**翻譯後的名稱**搜尋
- 這樣可以找到更準確的中文描述
- 如果名稱還沒翻譯，就用原始英文名稱

```python
# 範例
原始名稱: "Afterburner (UK) (1988) [a1]"
清理後: "Afterburner"
翻譯後: "加州熱燒室"

搜尋描述時會用: "加州熱燒室" ← 更容易找到中文描述！
```

## 使用範例

### 情境 1：完全空白的描述

**字典檔內容**：
```json
{
  "original_name": "Afterburner (UK) (1988) [a1]",
  "name": "加州熱燒室",
  "name_source": "api",
  "original_desc": "",
  "desc": "",
  "desc_source": ""
}
```

**執行翻譯後**：
```json
{
  "original_name": "Afterburner (UK) (1988) [a1]",
  "name": "加州熱燒室",
  "name_source": "api",
  "original_desc": "",
  "desc": "《加州熱燒室》是一款經典的飛行射擊遊戲...",
  "desc_source": "wiki"  ← 從維基百科搜尋到的
}
```

### 情境 2：原始描述存在但為空白

**字典檔內容**：
```json
{
  "original_name": "Super Game",
  "original_desc": "   ",  ← 只有空白字元
  "desc": "",
  "desc_source": ""
}
```

**行為**：
- ✓ 會被視為空白描述
- ✓ 自動使用名稱搜尋
- ✓ 填入搜尋到的描述

## 如何觸發此功能

### 方法 1：重新執行翻譯（推薦）

1. 確保設定中**勾選「翻譯遊戲描述」**
2. **取消勾選「跳過已翻譯項目」**（重要！）
3. 執行「階段三：翻譯」
4. 程式會檢測到空白描述並自動搜尋

### 方法 2：刪除空白描述後重新翻譯

1. 打開字典檔（`language_packs/zh-TW/平台名稱.json`）
2. 找到 `desc` 為空的項目
3. 確保 `desc_source` 也是空的：
   ```json
   "desc": "",
   "desc_source": ""
   ```
4. 儲存檔案
5. 執行翻譯（記得取消勾選「跳過已翻譯」）

### 方法 3：使用「重新翻譯」標記

在字典檔中設定：
```json
{
  "needs_retranslate": true,
  "desc": "",
  "desc_source": ""
}
```

## 日誌訊息

翻譯時，日誌會顯示描述的來源：

```
[INFO] [Stage3]   ✓ Afterburner → 加州熱燒室 (api)
                    描述來源: wiki
```

## 注意事項

### ⚠️ 不會自動觸發的情況

1. **已有描述內容**
   ```json
   "desc": "已經有內容了",
   "desc_source": "api"
   ```
   ↑ 不會重新搜尋（除非標記 `needs_retranslate: true`）

2. **勾選了「跳過已翻譯項目」**
   - 即使 desc 為空，如果有 `desc_source`，就會被跳過
   - 請**取消勾選**此選項

### ✅ 會自動觸發的情況

1. ✓ `desc` 和 `desc_source` 都是空的
2. ✓ `original_desc` 是空的或只有空白
3. ✓ 設定中勾選了「翻譯遊戲描述」
4. ✓ 沒有勾選「跳過已翻譯項目」

## 效果預期

### 成功案例

對於熱門遊戲（如經典 FC/SFC 遊戲），維基百科通常能找到描述：
- 勇者鬥惡龍
- 最終幻想
- 超級瑪利歐
- 洛克人
- 惡魔城

### 可能失敗的案例

對於冷門或地區限定遊戲，可能找不到描述：
- 小廠商獨立遊戲
- 僅在特定地區發行的遊戲
- Demo 版本、Beta 版本
- 自製遊戲

這種情況下，`desc` 會保持空白，不會強制填入錯誤內容。

## 效能影響

- **維基百科搜尋**：約 0.5-1 秒/遊戲
- **Gemini AI**：約 1-2 秒/遊戲（需要 API key）
- **已啟用快取**：重複搜尋的遊戲會從快取讀取，幾乎無延遲

## 測試步驟

1. **找一個 desc 為空的遊戲**
   ```bash
   # 在 PowerShell 中搜尋
   Get-Content "language_packs/zh-TW/amstradcpc.json" | ConvertFrom-Json | 
   Select-Object -ExpandProperty PSObject.Properties | 
   Where-Object { $_.Value.desc -eq "" } | 
   Select-Object -First 1 -ExpandProperty Value
   ```

2. **記下遊戲名稱**

3. **執行翻譯**
   - 取消勾選「跳過已翻譯項目」
   - 勾選「翻譯遊戲描述」
   - 只選擇該平台

4. **檢查結果**
   - 查看日誌是否顯示「描述來源: wiki」或「描述來源: gemini」
   - 打開字典檔確認 `desc` 是否已填入

## 故障排除

### Q: 為什麼 desc 還是空的？

A: 檢查以下幾點：
1. 是否勾選了「翻譯遊戲描述」？
2. 是否取消勾選了「跳過已翻譯項目」？
3. 網路連線是否正常？
4. 維基百科是否真的有這款遊戲的資料？

### Q: 可以手動指定要搜尋的遊戲嗎？

A: 可以！編輯字典檔，設定：
```json
{
  "needs_retranslate": true,
  "desc": "",
  "desc_source": ""
}
```

然後重新執行翻譯。

### Q: 搜尋結果不準確怎麼辦？

A: 
1. 先翻譯名稱（程式會優先用翻譯後的名稱搜尋）
2. 或手動編輯 `desc` 欄位
3. Gemini AI 通常會比維基百科更準確（需要 API key）

## 總結

✅ **現在會自動處理**：空白描述會自動用名稱搜尋並填入  
✅ **智能搜尋**：優先使用已翻譯的中文名稱搜尋  
✅ **多來源**：維基百科 → Gemini AI → 保持空白  
✅ **有快取**：重複搜尋不會浪費時間  

只要取消勾選「跳過已翻譯項目」，重新執行翻譯即可！
