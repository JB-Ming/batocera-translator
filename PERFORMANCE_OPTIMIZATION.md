# ç¿»è­¯æ•ˆèƒ½å„ªåŒ–èªªæ˜

## å„ªåŒ–å‰ç‹€æ³
- å¹³å‡æ¯å€‹éŠæˆ²ç¿»è­¯æ™‚é–“ï¼š**12 ç§’**
- ä¸»è¦ç“¶é ¸ï¼šä¸²è¡Œè™•ç† + é•·å»¶é² + ç„¡å¿«å–

## ç¿»è­¯æœå‹™é †åºèªªæ˜

### ç•¶å‰é †åº
ç¶­åŸºç™¾ç§‘ â†’ Gemini AI â†’ ç¶²è·¯æœå°‹ â†’ API ç›´è­¯

### é †åºé‚è¼¯

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¶­åŸºç™¾ç§‘æœå°‹ â”‚ - å„ªé»: å®˜æ–¹è­¯åï¼Œæœ€æº–ç¢º
â”‚  (å…è²»)     â”‚ - ç¼ºé»: å†·é–€éŠæˆ²æ‰¾ä¸åˆ°
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â†“ æ‰¾ä¸åˆ°
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Gemini AI  â”‚ - å„ªé»: AI æ™ºæ…§ç¿»è­¯ï¼Œå“è³ªé«˜
â”‚ (éœ€è¦ key)  â”‚ - ç¼ºé»: éœ€è¦ API é¡åº¦
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â†“ æ‰¾ä¸åˆ°æˆ–ç„¡ key
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç¶²è·¯æœå°‹   â”‚ - å„ªé»: å¯èƒ½æ‰¾åˆ°ç¤¾ç¾¤è­¯å
â”‚  (å…è²»)     â”‚ - ç¼ºé»: çµæœä¸ç©©å®š
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â†“ æ‰¾ä¸åˆ°
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  API ç›´è­¯   â”‚ - å„ªé»: ä¸€å®šèƒ½ç¿»è­¯
â”‚  (å…è²»)     â”‚ - ç¼ºé»: å“è³ªä¸€èˆ¬
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### é‡è¦ç‰¹æ€§

1. **æ‰¾åˆ°å³åœæ­¢** âœ…
   - æ‰¾åˆ°æœ‰æ•ˆçµæœå¾Œç«‹å³è¿”å›
   - é¿å…æµªè²» API é¡åº¦å’Œæ™‚é–“
   - é€™æ˜¯æ­£ç¢ºä¸”é«˜æ•ˆçš„è¨­è¨ˆ

2. **Gemini è‡ªå‹•è·³é** âœ…
   - æ²’æœ‰ API key æ™‚ï¼ŒGemini ä¸æœƒè¢«åˆå§‹åŒ–
   - è‡ªå‹•è·³åˆ°ä¸‹ä¸€å€‹æœå‹™ï¼ˆç¶²è·¯æœå°‹ï¼‰
   - ä¸å½±éŸ¿æ•´é«”æµç¨‹

3. **æœå‹™é™ç´šæ©Ÿåˆ¶**
   - æ¯å€‹æœå‹™å¤±æ•—æ™‚è‡ªå‹•é™ç´šåˆ°ä¸‹ä¸€å€‹
   - ç¢ºä¿ç¸½èƒ½å¾—åˆ°ç¿»è­¯çµæœ

### å»ºè­°çš„é †åºèª¿æ•´

æ ¹æ“šä¸åŒä½¿ç”¨æƒ…å¢ƒï¼Œå¯ä»¥è€ƒæ…®èª¿æ•´é †åºï¼š

#### æ–¹æ¡ˆ Aï¼šç•¶å‰æ–¹æ¡ˆï¼ˆå¹³è¡¡å‹ï¼‰âœ…
```
ç¶­åŸºç™¾ç§‘ â†’ Gemini â†’ æœå°‹ â†’ API
```
- **é©åˆ**: æœ‰ Gemini keyï¼Œæƒ³è¦æœ€ä½³å“è³ª
- **å„ªé»**: å„ªå…ˆä½¿ç”¨æœ€æº–ç¢ºçš„ä¾†æº
- **ç¼ºé»**: Gemini æœ‰æˆæœ¬

#### æ–¹æ¡ˆ Bï¼šå…è²»å„ªå…ˆå‹
```
ç¶­åŸºç™¾ç§‘ â†’ æœå°‹ â†’ API â†’ Gemini
```
- **é©åˆ**: ç¯€çœ API æˆæœ¬
- **å„ªé»**: å…è²»æœå‹™å„ªå…ˆï¼Œé™ä½æˆæœ¬
- **ç¼ºé»**: å¯èƒ½å¾—åˆ°è¼ƒå·®çš„ç¿»è­¯

#### æ–¹æ¡ˆ Cï¼šé€Ÿåº¦å„ªå…ˆå‹
```
Gemini â†’ ç¶­åŸºç™¾ç§‘ â†’ API â†’ æœå°‹
```
- **é©åˆ**: ä¸åœ¨æ„æˆæœ¬ï¼Œè¿½æ±‚é€Ÿåº¦
- **å„ªé»**: Gemini é€šå¸¸æ›´å¿«ä¸”æ›´æº–
- **ç¼ºé»**: API æˆæœ¬é«˜

**å»ºè­°**: ä¿æŒç•¶å‰æ–¹æ¡ˆ Aï¼ˆå¹³è¡¡å‹ï¼‰

### æˆæœ¬èˆ‡å“è³ªåˆ†æ

| æœå‹™ | å“è³ª | é€Ÿåº¦ | æˆæœ¬ | å‘½ä¸­ç‡ |
|------|------|------|------|--------|
| ç¶­åŸºç™¾ç§‘ | â­â­â­â­â­ | ğŸš€ğŸš€ | å…è²» | ~40% |
| Gemini | â­â­â­â­ | ğŸš€ğŸš€ğŸš€ | ä»˜è²» | ~90% |
| ç¶²è·¯æœå°‹ | â­â­â­ | ğŸš€ | å…è²» | ~30% |
| API ç›´è­¯ | â­â­ | ğŸš€ğŸš€ | å…è²» | 100% |

**æœ€ä½³ç­–ç•¥**: 
- ç¶­åŸºç™¾ç§‘èƒ½æ‰¾åˆ° 40% ç†±é–€éŠæˆ²çš„å®˜æ–¹è­¯åï¼ˆå…è²»ï¼‰
- å‰©ä¸‹ 60% ä¸­ï¼ŒGemini èƒ½è™•ç† 90%ï¼ˆå°æˆæœ¬ï¼‰
- æœ€å¾Œ 10% ç”¨å…è²» APIï¼ˆå“è³ªå¯æ¥å—ï¼‰

## å·²å¯¦æ–½çš„å„ªåŒ–

### 1. é™ä½ API è«‹æ±‚å»¶é²
**è®Šæ›´ä½ç½®**: [src/utils/settings.py](src/utils/settings.py)

```python
# ä¿®æ”¹å‰
request_delay: int = 2000  # ms

# ä¿®æ”¹å¾Œ  
request_delay: int = 500   # ms (é™ä½ 75%)
```

**æ•ˆæœ**: æ¯æ¬¡ API è«‹æ±‚ç¯€çœ 1.5 ç§’

### 2. å¢åŠ ä¸¦è¡ŒåŸ·è¡Œç·’æ•¸
**è®Šæ›´ä½ç½®**: [src/utils/settings.py](src/utils/settings.py)

```python
# ä¿®æ”¹å‰
max_workers: int = 1       # å–®åŸ·è¡Œç·’

# ä¿®æ”¹å¾Œ
max_workers: int = 3       # 3 å€‹ä¸¦è¡ŒåŸ·è¡Œç·’
```

**æ•ˆæœ**: ç†è«–ä¸Šå¯é”åˆ° 3 å€é€Ÿåº¦æå‡

### 3. æ·»åŠ è¨˜æ†¶é«”å¿«å–æ©Ÿåˆ¶
**è®Šæ›´ä½ç½®**: 
- [src/services/wikipedia.py](src/services/wikipedia.py)
- [src/services/translate.py](src/services/translate.py)

```python
# Wikipedia æœå‹™å¿«å–
self._search_cache = {}    # æœå°‹çµæœå¿«å–
self._desc_cache = {}      # æè¿°å¿«å–

# ç¿»è­¯ API å¿«å–
self._cache = {}           # ç¿»è­¯çµæœå¿«å–
```

**æ•ˆæœ**: 
- é¿å…é‡è¤‡æŸ¥è©¢ç›¸åŒéŠæˆ²ï¼ˆå¦‚ç³»åˆ—ä½œã€é‡è¤‡åç¨±ï¼‰
- æ¸›å°‘ 90% ä»¥ä¸Šçš„é‡è¤‡ API è«‹æ±‚

### 4. å„ªåŒ–ç¿»è­¯æµç¨‹
**è®Šæ›´ä½ç½®**: [src/core/translator.py](src/core/translator.py)

```python
# æ‰¾åˆ°æœ‰æ•ˆçµæœå¾Œç«‹å³è¿”å›ï¼Œä¸ç¹¼çºŒå˜—è©¦å…¶ä»–æ–¹æ³•
if result and result != name:
    return result, source
```

**æ•ˆæœ**: æ¸›å°‘ä¸å¿…è¦çš„ API å‘¼å«

### 5. èª¿æ•´æ‰¹æ¬¡å¤§å°
**è®Šæ›´ä½ç½®**: [src/utils/settings.py](src/utils/settings.py)

```python
# ä¿®æ”¹å‰
batch_size: int = 50       # æ‰¹æ¬¡è¼ƒå¤§

# ä¿®æ”¹å¾Œ
batch_size: int = 20       # æ‰¹æ¬¡è¼ƒå°
```

**æ•ˆæœ**: 
- æ›´é »ç¹çš„é€²åº¦æ›´æ–°
- æ›´å¥½çš„åŸ·è¡Œç·’å¹³è¡¡

## é æœŸæ•ˆèƒ½æå‡

### è¨ˆç®—å…¬å¼

```
åŸå§‹æ™‚é–“ = 12 ç§’/éŠæˆ²

å„ªåŒ–å¾Œæ™‚é–“ = (åŸºç¤æ™‚é–“ + API å»¶é²) / ä¸¦è¡Œæ•¸
           = (2 ç§’ + 0.5 ç§’) / 3
           = 0.83 ç§’/éŠæˆ²
```

### å¯¦éš›é æœŸ
è€ƒæ…®åˆ°ï¼š
- å¿«å–å‘½ä¸­ç‡ï¼š~30-50%ï¼ˆç³»åˆ—ä½œã€ç›¸ä¼¼éŠæˆ²ï¼‰
- ç¶²è·¯å»¶é²æ³¢å‹•
- åŸ·è¡Œç·’é–‹éŠ·

**é æœŸå¹³å‡æ™‚é–“**: **2-4 ç§’/éŠæˆ²**

**é€Ÿåº¦æå‡**: **3-6 å€**ï¼ˆå¾ 12 ç§’é™åˆ° 2-4 ç§’ï¼‰

## é€²ä¸€æ­¥å„ªåŒ–å»ºè­°

### çŸ­æœŸå„ªåŒ–ï¼ˆå¯ç«‹å³å¯¦æ–½ï¼‰

1. **èª¿æ•´å»¶é²åƒæ•¸**
   ```python
   # å¦‚æœæ²’æœ‰è¢«é™åˆ¶ï¼Œå¯ä»¥é€²ä¸€æ­¥é™ä½
   request_delay: int = 300  # é™åˆ° 300ms
   ```

2. **å¢åŠ åŸ·è¡Œç·’æ•¸**
   ```python
   # å¦‚æœ API å…è¨±ï¼Œå¯ä»¥å¢åŠ åˆ° 4-5
   max_workers: int = 4
   ```

3. **å•Ÿç”¨æŒä¹…åŒ–å¿«å–**
   - å°‡å¿«å–å„²å­˜åˆ°æª”æ¡ˆï¼ˆå¦‚ SQLite æˆ– JSONï¼‰
   - ç¨‹å¼é‡å•Ÿå¾Œä»å¯ä½¿ç”¨å¿«å–

### ä¸­æœŸå„ªåŒ–ï¼ˆéœ€è¦é–‹ç™¼ï¼‰

1. **æ‰¹æ¬¡ API è«‹æ±‚**
   ```python
   # ä¸€æ¬¡ç¿»è­¯å¤šå€‹æ–‡å­—ï¼Œæ¸›å°‘è«‹æ±‚æ¬¡æ•¸
   def batch_translate(texts: List[str]) -> List[str]:
       # ä½¿ç”¨æ”¯æ´æ‰¹æ¬¡çš„ API
   ```

2. **æ™ºèƒ½é‡è©¦æ©Ÿåˆ¶**
   ```python
   # å¤±æ•—æ™‚ä½¿ç”¨æŒ‡æ•¸é€€é¿é‡è©¦
   @retry(max_attempts=3, backoff=2)
   def translate_with_retry(text):
       ...
   ```

3. **é å–ç­–ç•¥**
   ```python
   # é å…ˆæŸ¥è©¢å³å°‡è™•ç†çš„éŠæˆ²
   def prefetch_translations(game_names: List[str]):
       ...
   ```

### é•·æœŸå„ªåŒ–ï¼ˆæ¶æ§‹æ”¹å–„ï¼‰

1. **æœ¬åœ°ç¿»è­¯æ¨¡å‹**
   - ä½¿ç”¨ MarianMT ç­‰æœ¬åœ°æ¨¡å‹
   - å®Œå…¨é›¢ç·šï¼Œç„¡å»¶é²

2. **åˆ†æ•£å¼ç¿»è­¯**
   - ä½¿ç”¨è¨Šæ¯ä½‡åˆ—ï¼ˆå¦‚ Redis Queueï¼‰
   - å¤šæ©Ÿå™¨ä¸¦è¡Œè™•ç†

3. **CDN å¿«å–**
   - å»ºç«‹ä¸­å¤®ç¿»è­¯è³‡æ–™åº«
   - æ‰€æœ‰ä½¿ç”¨è€…å…±äº«ç¿»è­¯çµæœ

## ç›£æ§èˆ‡èª¿æ•´

### æ•ˆèƒ½ç›£æ§æŒ‡æ¨™

```python
# å»ºè­°æ·»åŠ çš„ç›£æ§
- å¹³å‡ç¿»è­¯æ™‚é–“
- å¿«å–å‘½ä¸­ç‡
- API éŒ¯èª¤ç‡
- æ¯å€‹ä¾†æºçš„æˆåŠŸç‡ï¼ˆWiki/Gemini/APIï¼‰
```

### å‹•æ…‹èª¿æ•´ç­–ç•¥

```python
# æ ¹æ“š API å›æ‡‰å‹•æ…‹èª¿æ•´å»¶é²
if error_rate > 0.1:
    request_delay += 500  # å¢åŠ å»¶é²
elif error_rate < 0.01:
    request_delay = max(300, request_delay - 100)  # é™ä½å»¶é²
```

## è¨­å®šå»ºè­°

### ä¿å®ˆè¨­å®šï¼ˆç©©å®šå„ªå…ˆï¼‰
```python
request_delay: int = 800    # è¼ƒå®‰å…¨çš„å»¶é²
max_workers: int = 2        # è¼ƒå°‘çš„ä¸¦è¡Œ
batch_size: int = 30
```

### å¹³è¡¡è¨­å®šï¼ˆé è¨­å€¼ï¼‰âœ…
```python
request_delay: int = 500    # ç•¶å‰è¨­å®š
max_workers: int = 3        # ç•¶å‰è¨­å®š
batch_size: int = 20        # ç•¶å‰è¨­å®š
```

### æ¿€é€²è¨­å®šï¼ˆé€Ÿåº¦å„ªå…ˆï¼‰âš ï¸
```python
request_delay: int = 300    # å¯èƒ½è¢«é™åˆ¶
max_workers: int = 5        # è¼ƒé«˜ä¸¦è¡Œ
batch_size: int = 10
```

**æ³¨æ„**: æ¿€é€²è¨­å®šå¯èƒ½å°è‡´ API é™åˆ¶ï¼Œè«‹æ ¹æ“šå¯¦éš›æƒ…æ³èª¿æ•´

## æ¸¬è©¦çµæœ

æ¸¬è©¦å¾Œè«‹æ›´æ–°æ­¤å€å¡Šï¼š

```
æ¸¬è©¦æ—¥æœŸ: ____
æ¸¬è©¦å¹³å°: ____
éŠæˆ²æ•¸é‡: ____
å„ªåŒ–å‰æ™‚é–“: ____ ç§’/éŠæˆ²
å„ªåŒ–å¾Œæ™‚é–“: ____ ç§’/éŠæˆ²
é€Ÿåº¦æå‡: ____ å€
å¿«å–å‘½ä¸­ç‡: ____%
```

## æ•…éšœæ’é™¤

### å¦‚æœé€Ÿåº¦æ²’æœ‰æå‡

1. **æª¢æŸ¥åŸ·è¡Œç·’æ˜¯å¦æ­£å¸¸é‹ä½œ**
   - æŸ¥çœ‹æ—¥èªŒæ˜¯å¦é¡¯ç¤ºã€Œä½¿ç”¨ N å€‹åŸ·è¡Œç·’é€²è¡Œç¿»è­¯ã€

2. **æª¢æŸ¥ API æ˜¯å¦è¢«é™åˆ¶**
   - å¦‚æœéŒ¯èª¤ç‡é«˜ï¼Œå¢åŠ  `request_delay`

3. **æª¢æŸ¥ç¶²è·¯é€£ç·š**
   - ç¶²è·¯å»¶é²æœƒå½±éŸ¿æ•´é«”æ•ˆèƒ½

### å¦‚æœå‡ºç¾éŒ¯èª¤

1. **Too Many Requests (429)**
   - å¢åŠ  `request_delay` åˆ° 1000-2000ms
   - é™ä½ `max_workers` åˆ° 1-2

2. **Connection Timeout**
   - æª¢æŸ¥ç¶²è·¯é€£ç·š
   - å¢åŠ è¶…æ™‚æ™‚é–“

3. **è¨˜æ†¶é«”ä¸è¶³**
   - é™ä½ `batch_size`
   - å®šæœŸæ¸…ç†å¿«å–

## å›å¾©åŸè¨­å®š

å¦‚æœå„ªåŒ–å°è‡´å•é¡Œï¼Œå¯ä»¥å›å¾©åŸè¨­å®šï¼š

```python
request_delay: int = 2000
max_workers: int = 1
batch_size: int = 50
```

ä¸¦ç§»é™¤å¿«å–ç›¸é—œç¨‹å¼ç¢¼ã€‚
