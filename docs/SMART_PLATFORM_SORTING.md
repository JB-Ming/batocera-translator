# 智能平台排序功能

## 功能說明

翻譯時會**自動按遊戲數量從少到多**的順序處理平台，優先完成遊戲少的平台。

## 為什麼這樣設計？

### ✅ 優點

1. **快速看到成果**
   - 小平台（如 3-10 個遊戲）幾分鐘就能完成
   - 立即獲得成就感
   - 可以先驗證翻譯品質

2. **更好的進度回饋**
   - 早期會頻繁看到「平台完成」的訊息
   - 心理上感覺進度更快
   - 避免一直卡在大平台上

3. **降低風險**
   - 如果中途取消，至少小平台都完成了
   - 不會浪費時間在處理到一半的大平台

4. **效能優化**
   - 小平台快速完成，釋放記憶體
   - 大平台留到最後，有更多系統資源

### 📊 實際案例

**優化前（隨機順序）**：
```
處理順序:
1. snes (1200 個遊戲) ← 需要 40-80 分鐘
2. nes (850 個遊戲)  ← 需要 30-60 分鐘
3. gba (450 個遊戲)
4. mrboom (3 個遊戲) ← 只需 10 秒，卻排在最後
5. cannonball (1 個遊戲)
```
→ 前 2 小時都在處理大平台，看不到完成進度

**優化後（由小到大）**：
```
處理順序:
1. cannonball (1 個遊戲)     ✓ 5 秒完成！
2. mrboom (3 個遊戲)         ✓ 15 秒完成！
3. devilutionx (1 個遊戲)    ✓ 5 秒完成！
4. xash3d_fwgs (5 個遊戲)    ✓ 30 秒完成！
5. gba (450 個遊戲)          ← 15-30 分鐘
6. nes (850 個遊戲)          ← 30-60 分鐘
7. snes (1200 個遊戲)        ← 40-80 分鐘
```
→ 前 1 分鐘就完成 4 個平台！

## 工作原理

### 排序邏輯

```python
# 1. 掃描所有平台，計算遊戲數量
platform_sizes = {
    'cannonball': 1,
    'mrboom': 3,
    'snes': 1200,
    'nes': 850,
    ...
}

# 2. 按遊戲數量排序（從少到多）
platforms = sorted(platforms, key=lambda p: platform_sizes[p])

# 結果: ['cannonball', 'mrboom', ..., 'nes', 'snes']
```

### 日誌顯示

翻譯開始時，會在日誌中顯示處理順序：

```
[INFO] [Stage3] 選中 65 個平台進行翻譯
[INFO] [Stage3] 平台處理順序（按遊戲數量）: cannonball(1), mrboom(3), devilutionx(1), xash3d_fwgs(5), odcommander(1)...
[INFO] [Stage3] 共 65 個平台, 3458 個遊戲待處理
```

## 如何使用

### 自動啟用 ✅

這個功能**自動啟用**，不需要任何設定！

當你執行「階段三：翻譯」時：
1. 程式會自動掃描所有平台
2. 計算每個平台的遊戲數量
3. 按數量從少到多排序
4. 依序翻譯

### 查看排序結果

在翻譯開始時，查看日誌面板（程式底部），會顯示：

```
[INFO] [Stage3] 平台處理順序（按遊戲數量）: 
    平台1(遊戲數), 平台2(遊戲數), 平台3(遊戲數), ...
```

## 實際效果展示

### 範例：翻譯 10 個平台

**平台列表**：
```
amstradcpc   : 44 個遊戲
atari2600    : 7 個遊戲
c64          : 22 個遊戲
cannonball   : 1 個遊戲
gb           : 156 個遊戲
gba          : 89 個遊戲
gamegear     : 12 個遊戲
mrboom       : 3 個遊戲
nes          : 234 個遊戲
snes         : 312 個遊戲
```

**處理順序（自動排序）**：
```
1. ✓ cannonball (1)      ← 5 秒
2. ✓ mrboom (3)          ← 15 秒
3. ✓ atari2600 (7)       ← 30 秒
4. ✓ gamegear (12)       ← 1 分鐘
5. ✓ c64 (22)            ← 2 分鐘
6. ✓ amstradcpc (44)     ← 3 分鐘
7. ⏳ gba (89)            ← 6 分鐘
8. ⏳ gb (156)            ← 10 分鐘
9. ⏳ nes (234)           ← 16 分鐘
10. ⏳ snes (312)         ← 20 分鐘
```

**時間軸**：
- **前 1 分鐘**：完成 4 個平台 ✓✓✓✓
- **前 5 分鐘**：完成 6 個平台 ✓✓✓✓✓✓
- **前 10 分鐘**：完成 7 個平台
- **最後 50 分鐘**：處理最後 3 個大平台

## 進度計算

雖然優先處理小平台，但進度條仍然按**總遊戲數**計算：

```
總遊戲數 = 1 + 3 + 7 + 12 + 22 + 44 + 89 + 156 + 234 + 312 = 880

處理 cannonball (1 個遊戲) 後:
進度 = 1/880 = 0.1% ← 看起來很小

處理 mrboom (3 個遊戲) 後:
進度 = 4/880 = 0.5%

處理 nes (234 個遊戲) 後:
進度 = 782/880 = 88.9% ← 一下子跳很多
```

所以前面進度會慢慢增加，後面會快速跳躍。

## 選擇特定平台時

如果你只選擇某些平台翻譯，排序仍然有效：

**選擇**：`snes`, `nes`, `cannonball`, `mrboom`

**處理順序**：
```
1. cannonball (1)   ← 最小
2. mrboom (3)
3. nes (234)
4. snes (312)       ← 最大
```

## 效能提升

### 記憶體優化

小平台處理完後立即釋放記憶體，大平台有更多資源可用。

### 快取優化

```
小平台通常有共同遊戲（如經典大作）
→ 快速建立翻譯快取
→ 後面大平台處理時能享受快取加速
```

例如：
- `mrboom` 翻譯「炸彈人」
- 建立快取：「炸彈人」→ 維基百科描述
- 後面 `nes` 平台有 10 款炸彈人系列
- 直接使用快取，不需重複查詢

## 技術細節

### 排序時機

```python
# 1. 載入所有平台列表
platforms = ['snes', 'nes', 'cannonball', ...]

# 2. 計算每個平台的遊戲數量（同時載入字典）
platform_sizes = {}
for platform in platforms:
    dictionary = load_dictionary(platform)
    platform_sizes[platform] = len(dictionary)

# 3. 排序
platforms = sorted(platforms, key=lambda p: platform_sizes[p])

# 4. 開始翻譯（字典已載入，不需重複讀取）
```

### 效能影響

- **額外時間**：掃描階段約 0.1-0.5 秒（取決於平台數量）
- **節省時間**：由於優化了處理順序，整體不會增加時間
- **記憶體**：只在排序時多佔用少量記憶體，之後釋放

## 注意事項

### ℹ️ 進度條特性

因為優先處理小平台，進度條前期會增長較慢：

```
前 10% 時間 → 完成 50% 的平台（但只有 5% 的遊戲）
後 90% 時間 → 完成 50% 的平台（但有 95% 的遊戲）
```

這是**正常現象**，不代表程式變慢了！

### ⚡ 建議

1. **觀察平台完成訊息**，而不只是進度百分比
2. **小平台快速完成**會給你信心，證明程式正常運作
3. **大平台需要耐心**，但前面已經完成很多了

## 故障排除

### Q: 為什麼進度條前面很慢？

A: 這是正常的！因為：
- 前面處理的是小平台（遊戲少）
- 進度按總遊戲數計算
- 小平台對總進度貢獻小

但你會看到「✓ 平台 X 完成」的訊息頻繁出現！

### Q: 可以改成大平台優先嗎？

A: 不建議，因為：
- 心理上更難熬（要等很久才看到成果）
- 中途取消會損失更多
- 記憶體佔用更高

### Q: 選擇特定平台時也會排序嗎？

A: 是的！即使只選 2-3 個平台，也會按遊戲數量排序。

## 總結

✅ **自動啟用**：不需要任何設定  
✅ **智能排序**：小平台優先，大平台放後面  
✅ **快速成果**：幾分鐘內就能完成多個平台  
✅ **降低風險**：中途取消也不會浪費太多  
✅ **更好體驗**：頻繁看到完成訊息，心理上更舒服  

現在開始翻譯，享受「快速完成小平台」的成就感吧！🚀
