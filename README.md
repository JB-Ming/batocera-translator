# Batocera Gamelist 自動翻譯工具

<p align="center">
  <strong>🎮 讓你的復古遊戲收藏說中文！</strong>
</p>

---

## 這是什麼？

這是一個專為 **Batocera** 復古遊戲模擬器設計的多語系翻譯工具。

如果你使用 Batocera 來玩復古遊戲，可能會發現遊戲清單裡全是英文名稱：「Super Mario Bros」、「The Legend of Zelda」、「Contra」...

這個工具可以自動將這些英文名稱翻譯成你想要的語言：「超級瑪利歐兄弟」、「薩爾達傳說」、「魂斗羅」

不只遊戲名稱，連遊戲簡介也能一併翻譯！

---

## 主要特色

| 特色 | 說明 |
|------|------|
| ✨ **一鍵翻譯** | 選擇你的遊戲資料夾，點一下就能全部翻譯完成 |
| 🌏 **多語系支援** | 支援繁體中文、簡體中文、日文、韓文等語言 |
| 📚 **共享語系包** | 提供預先翻譯好的語系包，大部分遊戲不需要上網搜尋 |
| 🎯 **多種顯示模式** | 可選擇只顯示翻譯、翻譯+原文、或保持原樣 |
| 💾 **安全備份** | 翻譯前會自動備份原始檔案，不用擔心出問題 |
| 🖥️ **圖形化介面** | 不需要懂程式，打開就能用 |

---

## 支援的遊戲平台

這個工具支援 Batocera 中所有使用 `gamelist.xml` 的遊戲平台，包括但不限於：

| 縮寫 | 平台名稱 | 縮寫 | 平台名稱 |
|------|----------|------|----------|
| nes | 紅白機 FC | snes | 超級任天堂 |
| megadrive | Mega Drive | genesis | Sega Genesis |
| gba | Game Boy Advance | gb | Game Boy |
| gbc | Game Boy Color | nds | Nintendo DS |
| n64 | Nintendo 64 | ps1/psx | PlayStation |
| ps2 | PlayStation 2 | psp | PlayStation Portable |
| arcade | 街機 | mame | MAME 街機 |
| neogeo | Neo Geo | dreamcast | Dreamcast |
| saturn | Sega Saturn | pcengine | PC Engine |

---

## 快速開始

### 步驟一：下載並解壓縮

從 [Releases 頁面](../../releases) 下載最新版本，解壓縮到任意位置。

### 步驟二：啟動程式

雙擊執行 `Batocera翻譯工具.exe`，會看到主視窗。

### 步驟三：設定路徑

點選「瀏覽...」按鈕，選擇你的 Roms 目錄：
- Windows 本機：例如 `D:\Games\roms`
- WSL 環境：例如 `\\wsl.localhost\Ubuntu\userdata\roms`

### 步驟四：選擇目標語系

從下拉選單選擇要翻譯成的語言（預設為繁體中文）。

### 步驟五：開始翻譯

1. 點「預覽模式」查看將會變更的內容
2. 確認沒問題後，點「開始翻譯」
3. 等待進度條跑完即可

---

## 常見問題

### Q：程式會改動我的遊戲 ROM 嗎？

**不會！** 這個工具只會修改 `gamelist.xml` 這個遊戲清單檔案，你的遊戲 ROM 檔案完全不會被動到。

### Q：翻譯錯了怎麼辦？

程式在翻譯前會自動備份原始檔案到 `backups/` 資料夾。你可以隨時把備份檔案複製回去還原。

### Q：為什麼有些遊戲沒有被翻譯？

可能的原因：
1. 語系包中沒有這款遊戲的翻譯
2. 網路搜尋找不到對應的譯名
3. 遊戲名稱判定為保留原文（如 F-Zero、NBA 2K23）

### Q：可以只翻譯名稱不翻譯描述嗎？

可以！在設定中取消勾選「翻譯遊戲描述」選項即可。

### Q：翻譯速度很慢？

大部分遊戲可以透過語系包直接查詢，速度很快。如果語系包中沒有的遊戲，需要上網搜尋，每次搜尋之間會間隔 2-4 秒以避免被封鎖。

建議先匯入最新的語系包，可以大幅提升處理速度。

### Q：WSL 路徑是什麼？

如果你的 Batocera 是透過 Windows Subsystem for Linux (WSL) 安裝的，可以使用以下路徑格式：
- 新版：`\\wsl.localhost\Ubuntu\userdata\roms`
- 舊版：`\\wsl$\Ubuntu\userdata\roms`

---

# 技術規格

> 以下內容供開發者與進階使用者參考

---

## 工作原理

程式採用「掃描 → 產生字典 → 翻譯 → 寫回」的四階段流程。

---

### 階段一：掃描與取回

程式掃描指定的 ROM 資料夾，依資料夾名稱（如 `nes`、`snes`、`gba`）識別各遊戲平台，並將每個平台的 `gamelist.xml` 複製到本地暫存區。

**平台選擇功能：**

| 選項 | 說明 |
|------|------|
| 全部處理 | 掃描到的所有平台都會處理 |
| 勾選平台 | 僅處理使用者勾選的平台 |
| 排除平台 | 跳過指定的平台不處理 |

---

### 階段二：產生字典檔

程式解析 `gamelist.xml`，將遊戲資料整理成字典檔：

- **每個平台一份字典檔**（例如 `nes.json`、`snes.json`）
- **Key** = 遊戲檔名（即 XML 中的 `<path>` 欄位）
- **Value** = 包含以下欄位的物件：

| 欄位 | 說明 |
|------|------|
| `name` | 遊戲名稱翻譯 |
| `name_source` | 名稱翻譯來源標記 |
| `desc` | 遊戲描述翻譯 |
| `desc_source` | 描述翻譯來源標記 |

**翻譯來源標記 (source) 值：**

| 值 | 說明 |
|----|------|
| `wiki` | 來自維基百科 |
| `search` | 來自網路搜尋（非維基百科） |
| `api` | 來自翻譯 API 直譯 |
| `keep` | 判定為保留原文（無官方譯名） |
| `manual` | 手動填入 |
| `pack` | 來自語系包匯入 |
| *(空白)* | 尚未翻譯 |

---

### 階段三：翻譯

#### 翻譯查找優先順序

程式依以下順序查找翻譯，任一步驟找到即停止：

```
1. 本地字典（已翻譯）
        ↓ 未找到
2. 語系包（已匯入）
        ↓ 未找到
3. 維基百科搜尋
        ↓ 未找到
4. 其他網站搜尋
        ↓ 未找到
5. 保留原文判定 / API 直譯
```

#### 單一遊戲翻譯流程

翻譯流程優先從維基百科同時取得遊戲名稱與描述，找不到時才分別處理。

```
步驟 1：清理檔名，取得搜尋關鍵字
        ↓
步驟 2：搜尋維基百科
        → 找到：同時取得 name（標題）和 desc（摘要），標記為 wiki
        → 找不到：進入步驟 3
        ↓
步驟 3：分別處理
        name：繼續搜尋其他網站 → 標記 search
              搜尋失敗 → 保留原文判定或 API 直譯
        desc：直接使用翻譯 API → 標記 api
        ↓
步驟 4：保留原文判定（name 專用）
        判定為無官方譯名 → 保留原文，標記 keep
```

**清理檔名規則：**

| 清理項目 | 範例 |
|----------|------|
| 移除副檔名 | `.gba`, `.nes`, `.zip` |
| 移除區域標記 | `(Japan)`, `(USA)`, `(Europe)` |
| 移除版本標記 | `(Rev 1)`, `(Translated)` |
| 移除 ROM 標記 | `[!]`, `[T+Chi]`, `[a]` |

**保留原文判定條件：**

| 條件 | 範例 |
|------|------|
| 維基百科中文版頁面標題仍為英文 | F-Zero、R-Type |
| 名稱為純數字或品牌+數字組合 | FIFA 2024、NBA 2K23 |
| 翻譯結果與原文相同 | Tetris → Tetris |

---

### 階段四：寫回

將字典檔中的翻譯寫回 `gamelist.xml`。

**輸出目標：**

| 選項 | 說明 |
|------|------|
| 覆寫原始路徑（預設） | 直接修改 ROM 資料夾中的檔案 |
| 寫入本地暫存區 | 先檢查再手動複製回去 |
| 自訂路徑 | 產生全新副本 |

**顯示格式：**

| 格式 | 輸出範例 |
|------|----------|
| 僅中文 | 超級瑪利歐兄弟 |
| 中文 (英文) | 超級瑪利歐兄弟 (Super Mario Bros) |
| 英文 (中文) | Super Mario Bros (超級瑪利歐兄弟) |
| 僅保留原文 | Super Mario Bros |

---

## UI 設定選項

### 字典檔衝突處理

當產生字典檔時，若檔案已存在：

| 選項 | 說明 |
|------|------|
| 合併（預設） | 保留已翻譯內容，加入新遊戲 |
| 僅補空白 | 只填入空白欄位 |
| 覆寫 | 完全取代 |
| 跳過 | 不處理該平台 |

### 翻譯設定

| 選項 | 說明 |
|------|------|
| 翻譯遊戲名稱 | 是否處理 `name` 欄位 |
| 翻譯遊戲描述 | 是否處理 `desc` 欄位 |
| 搜尋時包含平台名稱 | 搜尋關鍵字前加上平台名 |
| 搜尋失敗時使用 API 直譯 | 最後手段 |
| 自動偵測保留原文 | 啟用保留原文判定邏輯 |

### 已翻譯項目處理

| 選項 | 說明 |
|------|------|
| 跳過已翻譯（預設） | 有 source 標記的項目不重新翻譯 |
| 僅重新翻譯直譯項目 | 僅對 source = api 的重新搜尋 |
| 全部重新翻譯 | 忽略現有翻譯 |

### 寫回設定

| 選項 | 說明 |
|------|------|
| name 處理策略 | 跳過已翻譯 / 字典優先 / XML 優先 / 全部覆寫 |
| desc 處理策略 | 跳過已翻譯 / 字典優先 / XML 優先 / 全部覆寫 |
| 寫入前自動備份 | 預設開啟 |
| 僅預覽不寫入 | 顯示變更但不修改檔案 |

### 翻譯 API 設定

| 選項 | 說明 |
|------|------|
| API 類型 | googletrans / Google Cloud / DeepL / Azure |
| API Key | 付費 API 的金鑰 |

---

## 進度與日誌顯示

程式採用**雙輸出**設計：即時顯示在 UI 上，同時寫入日誌檔案。

### UI 即時顯示

| 顯示項目 | 說明 |
|----------|------|
| 處理進度 | 第 N/M 個遊戲（含進度條） |
| 當前動作 | 搜尋中 / 翻譯中 / 寫入中 |
| 來源標記 | 顯示翻譯來自哪裡（wiki/search/api） |
| 結果統計 | 成功 / 跳過 / 失敗 數量 |

### 日誌檔案規劃

**檔案位置與命名：**

```
logs/
├── 2025-12-31_213000_translate.log    # 翻譯任務
├── 2025-12-31_214500_writeback.log    # 寫回任務
└── latest.log                          # 最新一次執行的捷徑
```

**檔案管理：**

| 設定 | 建議值 |
|------|--------|
| 保留天數 | 30 天 |
| 單檔大小上限 | 10 MB |
| 自動清理 | 每次啟動時清理過期日誌 |

### 日誌格式

```
[時間戳記] [級別] [模組] 訊息內容

範例：
[21:34:15] [INFO] [掃描] 開始掃描 ROM 目錄：D:\Games\roms
[21:34:16] [INFO] [掃描] 發現 5 個平台：nes, snes, gba, n64, psp
[21:34:17] [INFO] [字典] 產生字典檔：nes.json（合併模式，既有 120 筆，新增 15 筆）
[21:34:18] [INFO] [翻譯] Super Mario Bros (USA).nes → 超級瑪利歐兄弟 [wiki]
[21:34:20] [WARN] [翻譯] Unknown Game.nes → 搜尋失敗，使用 API 直譯 [api]
[21:34:22] [INFO] [翻譯] F-Zero (USA).snes → F-Zero [keep] (保留原文)
[21:34:25] [ERROR] [API] googletrans 請求失敗：Connection timeout
[21:34:26] [INFO] [寫回] 成功寫入 gamelist.xml（135 筆變更）
```

### 日誌級別

| 級別 | 顏色 | 用途 |
|------|------|------|
| `DEBUG` | 灰色 | 詳細除錯資訊（預設隱藏） |
| `INFO` | 白色 | 一般執行資訊 |
| `WARN` | 黃色 | 警告但不影響執行 |
| `ERROR` | 紅色 | 錯誤需要注意 |
| `SUCCESS` | 綠色 | 成功完成 |

### UI 日誌面板功能

| 功能 | 說明 |
|------|------|
| 即時捲動 | 自動捲動到最新訊息 |
| 暫停捲動 | 點擊面板暫停自動捲動 |
| 級別篩選 | 可勾選只顯示特定級別 |
| 搜尋功能 | 搜尋特定關鍵字 |
| 匯出日誌 | 將目前日誌匯出為檔案 |
| 清除畫面 | 清除 UI 上的日誌（不影響檔案） |

### 執行摘要

每次執行結束後輸出摘要：

```
════════════════════════════════════════
執行完成！
────────────────────────────────────────
目標語系：zh-TW
處理平台：nes, snes, gba
────────────────────────────────────────
總計：150 個遊戲
  ✓ 翻譯成功：120 (wiki: 80, search: 25, api: 15)
  ○ 保留原文：10 (keep)
  ─ 跳過已翻譯：18
  ✗ 失敗：2
────────────────────────────────────────
耗時：2 分 35 秒
日誌檔案：logs/2025-12-31_213000_translate.log
════════════════════════════════════════
```



## 預覽模式

點擊「預覽模式」可在實際寫入前查看變更內容：

| 顯示項目 | 說明 |
|----------|------|
| 變更前後對照 | 顯示原本與翻譯後的差異 |
| 變更類型標示 | 新增 / 覆寫 / 跳過 |
| 篩選功能 | 可篩選只顯示某類變更 |
| 展開詳細 | 點擊展開查看完整內容 |

---

## 手動編輯字典

如需修正翻譯錯誤，可直接編輯字典檔：

1. 開啟 `dictionaries/{語系}/{platform}.json`
2. 找到對應的遊戲 Key
3. 修改 `name` 或 `desc` 欄位
4. 將 `source` 標記改為 `manual`
5. 存檔後重新執行寫回

> 💡 未來版本可能提供 UI 介面直接編輯字典。

---

## 中斷與續傳

| 功能 | 說明 |
|------|------|
| 取消執行 | 翻譯進行中可點擊「取消」按鈕中斷 |
| 自動存檔 | 已完成的翻譯會即時存入字典檔 |
| 斷點續傳 | 下次執行時會跳過已有 source 的項目 |

---

## 錯誤處理機制

| 錯誤類型 | 處理方式 |
|----------|----------|
| 網路斷線 | 暂停並顯示重試按鈕，已完成部分已存檔 |
| API 限流 | 自動增加間隔時間並重試 |
| API 額度用盡 | 提示使用者更換API或等待重置 |
| XML 格式錯誤 | 跳過該檔案並記錄日誌 |
| 字典檔損毀 | 嘗試從備份回復或重新產生 |

---

## 多語系支援

程式支援翻譯成多種語言：

| 語系代碼 | 語言名稱 | 維基百科 |
|----------|----------|----------|
| `zh-TW` | 繁體中文 | zh.wikipedia.org |
| `zh-CN` | 簡體中文 | zh.wikipedia.org |
| `ja` | 日文 | ja.wikipedia.org |
| `ko` | 韓文 | ko.wikipedia.org |
| `en` | 英文 | en.wikipedia.org |

選擇目標語系後，程式會自動搜尋對應語言的維基百科，並使用對應語言的翻譯 API。

---

## 字典檔與語系包

字典檔與語系包採用**相同格式**，差別僅在 `source` 標記：

| 項目 | 說明 | source 標記 |
|------|------|-------------|
| 本地翻譯 | 程式自動翻譯或手動填入 | `wiki`、`search`、`api`、`manual` |
| 語系包匯入 | 從社群分享的語系包匯入 | `pack` |

**字典檔範例：**

```json
{
  "Super Mario Bros (USA).nes": {
    "name": "超級瑪利歐兄弟",
    "name_source": "pack",
    "desc": "經典的平台跳躍遊戲...",
    "desc_source": "api"
  }
}
```

**匯入語系包：**

1. 程式內建基本語系包
2. 從 GitHub 下載最新版本
3. 手動選擇 JSON 檔案匯入

**匯入合併規則：** 本地已有翻譯的項目會保留，僅填入空白項目。

**匯出與貢獻：** 使用「匯出字典」功能匯出後，可提交 Pull Request 貢獻給社群。

---

## 資料夾結構

```
project/
├── gamelists_local/          # gamelist.xml 暫存區
│   ├── nes/
│   │   └── gamelist.xml
│   └── ...
│
├── dictionaries/             # 字典檔（依語系分類）
│   ├── zh-TW/
│   │   ├── nes.json
│   │   └── ...
│   ├── ja/
│   └── ko/
│
├── logs/                     # 日誌檔案
│   ├── 2025-12-31_213000_translate.log
│   └── latest.log
│
└── backups/                  # 原始檔案備份
    └── 2025-12-31_211500/
```

| 資料夾 | 說明 |
|--------|------|
| `gamelists_local/` | 從 ROM 資料夾複製來的 gamelist.xml |
| `dictionaries/{語系}/` | 字典檔（含本地翻譯與匯入的語系包） |
| `logs/` | 日誌檔案（自動清理超過 30 天的檔案） |
| `backups/` | 原始檔案備份（含時間戳記） |

---

## 系統需求

- **作業系統**：Windows 10 / 11
- **如使用 WSL**：Windows 10 1903 以上版本

---

## 版本更新紀錄

| 版本 | 日期 | 說明 |
|------|------|------|
| 1.0 | 2025-11-27 | 初始版本 |

---

## 授權條款

本專案採用 MIT License 授權，歡迎自由使用與改進。

---

## 聯絡與回饋

- 🐛 回報問題：請到 [GitHub Issues](../../issues) 開 Issue
- 💬 討論交流：歡迎在 Issues 中討論
- 🤝 貢獻翻譯：歡迎提交 Pull Request

---

<p align="center">
  <strong>讓復古遊戲更親切，讓回憶更美好！</strong>
</p>